---
title: "lmer_sample_code"
format: html
editor: visual
---

```{r}
#| message: false
library(tidyverse)
library(here)
library(readxl)
library(lme4)
library(lmerTest)
library(emmeans)
```

```{r}
# load in data
color <- read_excel(here('Meat_Data.xlsx'), sheet = 'sorted beef color ')
tbars <- read_excel(here('Meat_Data.xlsx'), sheet = 'sorted beef TBARS')
ph <- read_excel(here('Meat_Data.xlsx'), sheet = 'pH')

```

```{r}
# clean set
master <- color %>%
  mutate(batch = toupper(batch),
         steak = ifelse(batch == "A" & trt == "KK" & display == 0 & index == 2, "b", steak)) %>%
  left_join(tbars, by = c("batch" = "Batch", "steak" = "patty replicates", "display" = "Display",
                           "index", "trt", "muscle")) %>%
  inner_join(ph, by = c("trt" = "Cutting", "steak", "muscle", "index", "batch", "display")) %>%
  select(batch, trt, display, index, steak, muscle, `average L`, `average a`, `average b`, `Abs531 average`, `pH-ave`)

```

```{r}
# SAMPLE CODE 

# fit linear mixed model
mod <- lmer(trt*muscle*display + (1 | Batch), data = data_name)
anova(mod)
plot(mod)

# obtain estimates
ests <- emmeans(mod, specs = ~ trt:muscle:display, infer = c(T,T))

# compare muscles
emmeans(mod, specs = ~ muscle | trt:display) |> pairwise()
```

```{r}
est |> 
as_tibble() |>
ggplot(x = display,
       color = muscle
) +
geom_point(y = emmean) +
geom_errobar(ymin = lower, ymax = upper) +
# overlay this on the original observed data for a gut check
geom_jitter(data = original_data, y = observed) +
facet(~trt)
```
